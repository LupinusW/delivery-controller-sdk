<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Get-BrokerDBSchema - Citrix PowerShell SDK Documentation</title>
  

  <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/base.css">
  <link rel="stylesheet" href="../../css/highlight.css">
  <link rel="stylesheet" href="../../css/override.css" type="text/css" />
  <link rel="stylesheet" href="../../css/font-awesome.css" type="text/css" />

  
  <script>
    // Current page data
    var mkdocs_page_name = "Get-BrokerDBSchema";
    var mkdocs_page_input_path = "Broker/Get-BrokerDBSchema.md";
    var mkdocs_page_url = "/Broker/Get-BrokerDBSchema/";
  </script>
  
  <script src="../../js/jquery-1.10.2.min.js"></script>
  <script src="../../js/bootstrap-3.0.3.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/base.js"></script>
  <script src="../../js/custom.js"></script>
  <script src="../../js/nav.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document" data-spy="scroll" data-target=".bs-sidebar">

	<div class="header-top">
		<div class="header-top-left">
			<a href="http://citrix.github.io" class="logo-position"><img height="60" src="https://thumbnail-ec2.sharefile.com/thumbnail.aspx?encparams=ypL2J0l-In6gqXJ7yeyKP8A1rqwKMH-C8-nfkJcHJNIN7Y0yZiJsYOcUe-uc0YeZzWLQSFSd1FnuMHPa30XSSINHuGOA8nvvnBT5WmjGlKvd5mxJ4IfT7iTVyHELwhWQiNCznPCiIFyhkA78uKX77PlU2iyhM4YdRM1NKabBe-4wXuiFJsbtAxyJ2UukO_E2ZSf1W3l75Dw8G0zflVkT-EFqyx1zSGId0qzLjm6nzJ8dA9zo-1AJzUisdzmGMzHOq_LMsOWyaalvmcWvCkl-q10GBSbfekfTIFW9LpZNYjkLNSnK8rcwNjWVr_jYayrGjIj2e5dDIMiDj3NRvW51AvHRjxYH9xRRRtY$" target="_blank" class="logo-citrix"><span style="color:#fff;font-size: 20px;position: relative;top:4px;left: 5px">SDK Reference</span></a>
		</div>
		<div class="header-top-right">
			<ul>
			<!--	<li class="list-inline home"><a href="../..">HOME</a></li>
				<li class="list-inline support"><a href="http://support.citrix.com">SUPPORT</a></li>-->
				<form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <li class="list-inline support"><input name="q" id="txtName" type="text" placeholder="Search SDKs"
            class="searchdocs">
<a class="fa fa-search errspan"></a></li>
</form>
				<!--<li class="list-inline"><a href="http://citrix.com/download">DOWNLOADS</a></li>-->
			</ul>

		</div>
	</div>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
			<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#syntax">Syntax</a></li>
        
    
        <li class="main "><a href="#detailed-description">Detailed Description</a></li>
        
    
        <li class="main "><a href="#related-commands">Related Commands</a></li>
        
    
        <li class="main "><a href="#parameters">Parameters</a></li>
        
    
        <li class="main "><a href="#input-type">Input Type</a></li>
        
            <li><a href="#none">None</a></li>
        
    
        <li class="main "><a href="#return-values">Return Values</a></li>
        
            <li><a href="#systemstring">System.String</a></li>
        
    
        <li class="main "><a href="#examples">Examples</a></li>
        
            <li><a href="#example-1">EXAMPLE 1</a></li>
        
            <li><a href="#example-2">EXAMPLE 2</a></li>
        
    
    </ul>
</div>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      


      
      <div class="wy-nav-content">
        <div class="rst-content">
         <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Broker &raquo;</li>
        
      
    
    <li>Get-BrokerDBSchema</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
          <div role="main">
            <div class="section">
             
                <p>ï»¿# Get-BrokerDBSchema</p>
<p>Gets SQL scripts to create or maintain the database schema for the Citrix Broker Service.</p>
<h2 id="syntax"><a class="toclink" href="#syntax">Syntax</a></h2>
<div class="codehilite"><pre><span></span>Get-BrokerDBSchema -DatabaseName &lt;String&gt; [-ServiceGroupName &lt;String&gt;] [-ScriptType &lt;DatabaseScriptType&gt;] [-SID &lt;String&gt;] [-LocalDatabase] [-AdminAddress &lt;String&gt;] [&lt;CommonParameters&gt;]
</pre></div>


<h2 id="detailed-description"><a class="toclink" href="#detailed-description">Detailed Description</a></h2>
<p>Gets SQL scripts that can be used to create a new Citrix Broker Service database schema, add a new Broker service to an existing site, remove a Broker service from a site, or create a database server logon for a Broker service.</p>
<p>If no Sid parameter is provided, the scripts obtained relate to the currently selected Broker service instance, otherwise the scripts relate to Broker service instance running on the machine identified by the Sid provided. When obtaining the Evict script, a Sid parameter must be supplied.</p>
<p>The current service instance is the one on the local machine, or the one most recently specified using the -AdminAddress parameter of a Broker SDK cmdlet.</p>
<p>The service instance used to obtain the scripts does not need to be a member of a site or to have had its database connection configured.</p>
<p>The database scripts support only Microsoft SQL Server, or SQL Server Express, and require Windows integrated authentication to be used. They can be run using SQL Server's SQLCMD utility, or by copying the script into an SQL Server Management Studio (SSMS) query window and executing the query. If using SSMS, the query must be executed in 'SQLCMD mode'.</p>
<p>The ScriptType parameter determines which script is obtained. If ScriptType is not specified, or is FullDatabase, the script contains:</p>
<p>o    Creation of service schema
o    Creation of database server logon
o    Creation of database user
o    Addition of database user to Broker service roles</p>
<p>If ScriptType is Instance, the returned script contains:</p>
<p>o    Creation of database server logon
o    Creation of database user
o    Addition of database user to Broker service roles</p>
<p>If ScriptType is Evict, the returned script contains:</p>
<p>o    Removal of Broker service instance from database
o    Removal of database user</p>
<p>If ScriptType is Login, the returned script contains:</p>
<p>o    Creation of database server logon only</p>
<p>ScriptType Database is deprecated, and FullDatabase should be used instead.</p>
<p>If the service uses two data stores they can exist in the same database.</p>
<p>You do not need to configure a database before using this command.</p>
<h2 id="related-commands"><a class="toclink" href="#related-commands">Related Commands</a></h2>
<ul>
<li><a href="../Set-BrokerDBConnection.html">Set-BrokerDBConnection</a></li>
<li><a href="../Test-BrokerDBConnection.html">Test-BrokerDBConnection</a></li>
</ul>
<h2 id="parameters"><a class="toclink" href="#parameters">Parameters</a></h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Required?</th>
<th>Pipeline Input</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DatabaseName</td>
<td>Specifies the name of the database into which the new Broker service schema is to be placed, or in which it already exists. The database itself is not created by any of the script types; it must already exist before the scripts are run.</td>
<td>true</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>ServiceGroupName</td>
<td>Specifies the name of the service group to be used when creating the database schema. The service group is a collection of all the Broker services that share the same database instance and are considered equivalent; that is, all the services within a service group can be used interchangeably.</td>
<td>false</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>ScriptType</td>
<td>Specifies the type of database script returned. Available script types are:<br>-- FullDatabase<br>Creates a database schema for the Citrix Broker Service in a database instance that does not already contain one. This is used when creating a new site. DatabaseName and ServiceGroupName are required parameters for this script type.<br>-- Instance<br>Adds a Broker Service instance to a database and so to the associated site. Appropriate database server logons and users are created to allow the service instance access to the required service schemas.<br>-- Evict<br>Removes a Broker Service instance from the database and so from the site. All reference to the service instance is removed from the database. DatabaseName and Sid are required parameters for this script type.<br>-- Login<br>Adds a logon for the Broker Service instance to a database server. This is specifically for use when configuring SQL Server mirroring where the mirror server must have appropriate logons created for all service instances in the site.<br>-- Database<br>This is deprecated. FullDatabase should be used instead.</td>
<td>false</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>SID</td>
<td>Specifies the SID of the controller on which the Broker Service instance to remove from the database is running (only valid for a script type of Evict).</td>
<td>false</td>
<td>false</td>
<td>None</td>
</tr>
<tr>
<td>LocalDatabase</td>
<td>Specifies whether the database script is to be used in a database instance run on the same controller as other services in the service group. Including this parameter ensures the script creates only the required permissions for local services to access the database schema for Broker services. If this parameter is specified inappropriately, the service instance will not be able to connect to the database.</td>
<td>false</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>AdminAddress</td>
<td>Specifies the address of a XenDesktop controller that the PowerShell snapin will connect to. This can be provided as a host name or an IP address.</td>
<td>false</td>
<td>false</td>
<td>Localhost. Once a value is provided by any cmdlet, this value will become the default.</td>
</tr>
</tbody>
</table>
<h2 id="input-type"><a class="toclink" href="#input-type">Input Type</a></h2>
<h3 id="none"><a class="toclink" href="#none">None</a></h3>
<p>You cannot pipe input into this cmdlet.</p>
<h2 id="return-values"><a class="toclink" href="#return-values">Return Values</a></h2>
<h3 id="systemstring"><a class="toclink" href="#systemstring">System.String</a></h3>
<p>A string containing the required SQL script for applying to a database.## Notes
   The scripts returned support Microsoft SQL Server Express Edition, Microsoft SQL Server Standard Edition, and Microsoft SQL Server Enterprise Edition databases only, and are generated on the assumption that integrated authentication will be used.<br>    If the ScriptType parameter is not included or set to 'FullDatabase', the full database script is returned, which will:<br>        Create the database schema.<br>        Create the user and the role (providing the schema does not already exist).<br>        Create the logon (providing the schema does not already exist).<br>    If the ScriptType parameter is set to 'Instance', the script will:<br>        Create the user and the role (providing the schema does not already exist).<br>        Create the logon (providing the schema does not already exist) and associate it with a user.<br>    If the ScriptType parameter is set to 'Login', the script will:<br>        Create the logon (providing the schema does not already exist) and associate it with a pre-existing user of the same name.<br>    ScriptType value of 'Database' is deprecated; 'FullDatabase' should be used instead.<br>    If the LocalDatabase parameter is included, the NetworkService account will be added to the list of accounts permitted to access the database. This is required only if the database is run on a controller.<br>    If the command fails, the following errors can be returned.<br>    Error Codes<br>    -----------<br>    GetSchemasFailed<br>        The database schema could not be found.<br>    ActiveDirectoryAccountResolutionFailed<br>        The specified Active Directory account or Group could not be found.<br>    DatabaseError<br>        An error occurred in the service while attempting a database operation.<br>    DatabaseNotConfigured<br>        The operation could not be completed because the database for the service is not configured.<br>    DataStoreException<br>        An error occurred in the service while attempting a database operation - communication with the database failed for various reasons.<br>    PermissionDenied<br>        You do not have permission to execute this command.<br>    AuthorizationError<br>        There was a problem communicating with the Citrix Delegated Administration Service.<br>    CommunicationError<br>        There was a problem communicating with the remote service.<br>    ExceptionThrown<br>        An unexpected error occurred.  For more details, see the Windows event logs on the controller or the XenDesktop logs.</p>
<h2 id="examples"><a class="toclink" href="#examples">Examples</a></h2>
<h3 id="example-1"><a class="toclink" href="#example-1">EXAMPLE 1</a></h3>
<div class="codehilite"><pre><span></span>C:\PS&gt;Get-BrokerDBSchema -DatabaseName MySiteDB -ServiceGroupName  MyServiceGroup &gt; C:\BrokerSchema.sql
</pre></div>


<p>Description<br>-----------<br>Gets a script to create the full database schema for the Citrix Broker Service and copies it to a file called "C:\BrokerSchema.sql"<br>This script can be used to create the service schema in a database with name "MySiteDB", which must already exist, and must not already contain a Broker service schema.</p>
<h3 id="example-2"><a class="toclink" href="#example-2">EXAMPLE 2</a></h3>
<div class="codehilite"><pre><span></span>C:\PS&gt;Get-BrokerDBSchema -DatabaseName MySiteDB -ScriptType Login &gt; C:\BrokerLogins.sql
</pre></div>


<p>Description<br>-----------<br>Gets a script to create the appropriate database server logon for the Broker service. This can be used when configuring a mirror server for use.</p>
              

            </div>
          </div>

        </div>
      </div>

    </section>

  </div>

<!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../Get-BrokerDBConnection/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../Get-BrokerDBVersionChangeScript/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

</body>
</html>
