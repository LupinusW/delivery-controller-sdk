<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>about_Broker_PowerManagement - Citrix PowerShell SDK Documentation</title>
  

  <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/base.css">
  <link rel="stylesheet" href="../../css/highlight.css">
  <link rel="stylesheet" href="../../css/override.css" type="text/css" />
  <link rel="stylesheet" href="../../css/font-awesome.css" type="text/css" />

  
  <script>
    // Current page data
    var mkdocs_page_name = "about_Broker_PowerManagement";
    var mkdocs_page_input_path = "Broker/about_Broker_PowerManagement.md";
    var mkdocs_page_url = "/Broker/about_Broker_PowerManagement/";
  </script>
  
  <script src="../../js/jquery-1.10.2.min.js"></script>
  <script src="../../js/bootstrap-3.0.3.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/base.js"></script>
  <script src="../../js/custom.js"></script>
  <script src="../../js/nav.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document" data-spy="scroll" data-target=".bs-sidebar">

	<div class="header-top">
		<div class="header-top-left">
			<a href="http://citrix.github.io" class="logo-position"><img height="60" src="https://thumbnail-ec2.sharefile.com/thumbnail.aspx?encparams=ypL2J0l-In6gqXJ7yeyKP8A1rqwKMH-C8-nfkJcHJNIN7Y0yZiJsYOcUe-uc0YeZzWLQSFSd1FnuMHPa30XSSINHuGOA8nvvnBT5WmjGlKvd5mxJ4IfT7iTVyHELwhWQiNCznPCiIFyhkA78uKX77PlU2iyhM4YdRM1NKabBe-4wXuiFJsbtAxyJ2UukO_E2ZSf1W3l75Dw8G0zflVkT-EFqyx1zSGId0qzLjm6nzJ8dA9zo-1AJzUisdzmGMzHOq_LMsOWyaalvmcWvCkl-q10GBSbfekfTIFW9LpZNYjkLNSnK8rcwNjWVr_jYayrGjIj2e5dDIMiDj3NRvW51AvHRjxYH9xRRRtY$" target="_blank" class="logo-citrix"><span style="color:#fff;font-size: 20px;position: relative;top:4px;left: 5px">SDK Reference</span></a>
		</div>
		<div class="header-top-right">
			<ul>
			<!--	<li class="list-inline home"><a href="../..">HOME</a></li>
				<li class="list-inline support"><a href="http://support.citrix.com">SUPPORT</a></li>-->
				<form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <li class="list-inline support"><input name="q" id="txtName" type="text" placeholder="Search SDKs"
            class="searchdocs">
<a class="fa fa-search errspan"></a></li>
</form>
				<!--<li class="list-inline"><a href="http://citrix.com/download">DOWNLOADS</a></li>-->
			</ul>

		</div>
	</div>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
			<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#topic">TOPIC</a></li>
        
    
        <li class="main "><a href="#short-description">SHORT DESCRIPTION</a></li>
        
    
        <li class="main "><a href="#long-description">LONG DESCRIPTION</a></li>
        
    
        <li class="main "><a href="#hypervisor-connections">HYPERVISOR CONNECTIONS</a></li>
        
    
        <li class="main "><a href="#power-actions-and-throttling">POWER ACTIONS AND THROTTLING</a></li>
        
    
        <li class="main "><a href="#power-policy">POWER POLICY</a></li>
        
    
        <li class="main "><a href="#pool-size-management">POOL SIZE MANAGEMENT</a></li>
        
    
        <li class="main "><a href="#reboot-schedules">REBOOT SCHEDULES</a></li>
        
    
        <li class="main "><a href="#status">STATUS</a></li>
        
    
        <li class="main "><a href="#see-also">SEE ALSO</a></li>
        
    
    </ul>
</div>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      


      
      <div class="wy-nav-content">
        <div class="rst-content">
         <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Broker &raquo;</li>
        
      
    
    <li>about_Broker_PowerManagement</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
          <div role="main">
            <div class="section">
             
                <p>ï»¿# about_Broker_PowerManagement</p>
<h2 id="topic"><a class="toclink" href="#topic">TOPIC</a></h2>
<div class="codehilite"><pre><span></span>Citrix Broker SDK - Machine Power Management
</pre></div>


<h2 id="short-description"><a class="toclink" href="#short-description">SHORT DESCRIPTION</a></h2>
<div class="codehilite"><pre><span></span>Describes power management of machines used for desktops and applications.
</pre></div>


<h2 id="long-description"><a class="toclink" href="#long-description">LONG DESCRIPTION</a></h2>
<div class="codehilite"><pre><span></span>The Citrix Broker Service is in day-to-day control of the power state of 
the configured desktop and application machines. The Broker Service can 
control several hypervisors, each hypervisor connection being handled by 
its own site service, so all Broker Service communication to the hypervisor 
is through one of the controllers in the site.
</pre></div>


<h2 id="hypervisor-connections"><a class="toclink" href="#hypervisor-connections">HYPERVISOR CONNECTIONS</a></h2>
<div class="codehilite"><pre><span></span>Each hypervisor, or pool of linked hypervisors, is described and configured 
through the XdHyp pseudo-drive and associated Hyp PowerShell commands 
(cmdlets) which are provided by the host service snap-in. When you have 
first created the hypervisor connection using the host service cmdlets, you 
can create a broker equivalent object that references the Hyp instance using 
a GUID value. Use the broker&#39;s HypervisorConnection object to nominate a 
preferred controller for direct communication with the hypervisor on behalf 
of all other controllers for day-to-day power actions and status requests.
</pre></div>


<h2 id="power-actions-and-throttling"><a class="toclink" href="#power-actions-and-throttling">POWER ACTIONS AND THROTTLING</a></h2>
<div class="codehilite"><pre><span></span>The site, through the Broker Service, can control the power state of the 
machines used by the site for desktops and applications. Power state changes 
can have a number of causes:

o   Power policy rules, such as requests to shut down or suspend machines 
    when user sessions on those machines end or are disconnected 
o   If allowed, user-driven desktop restarts 
o   Session launch requests requiring machines to be started 
o   Pool size management, which controls the number of running machines 
o   Direct administrator request using the SDK or Citrix Studio 
o   Reboot schedules and cycles 
o   Performing personal vDisk inventory activities 
o   Cleaning machines back to the golden master image state after 
    they have been used

The power state changes of machines hosting desktops and applications are 
controlled using a queuing mechanism. Actions to change the power state 
are assigned a priority and are sent to the hypervisor according to a 
throttling mechanism. This avoids overloading the hypervisor.

The queuing and throttling mechanisms take place on a 
per-hypervisor-connection basis; each hypervisor connection&#39;s queue is 
dealt with independently. You can view the contents of the queues using 
the Get-BrokerHostingPowerAction cmdlet. This includes recently completed, 
in-progress, and pending actions (that is, those due to be sent to the 
hypervisor based on the throttling settings).

Each power action object comprises:

o    The machine to be acted on (Name, DNS Name, Hosting Name) 
o    The action to be performed (TurnOn, TurnOff, Shutdown, 
     Reset, Restart, Suspend, or Resume) 
o    The action&#39;s priority (Base, the original priority, and 
     Actual, the current priority) 
o    The action&#39;s state (Pending, Started, Completed, Failed, 
     Canceled, Deleted, or Lost) 
o    Time stamps of the action&#39;s lifecycle points (when it was created, 
     started, or completed) 
o    Any reason the action failed

The throttling of power actions is controlled by three metadata values on 
the Hyp hypervisor connection object when accessed through the XdHyp 
pseudo-drive. The four values throttle power actions according to:

o    The maximum absolute number of in-progress power actions 
o    The maximum number of in-progress power actions expressed as 
     a percentage of the total number of machines controlled by 
     the hypervisor connection 
o    The maximum number of new power actions sent to the 
     hypervisor per minute 
o    The maximum number of in-progress PvD inventory activities 
     expressed as a percentage of the total number of machines 
     controlled by the hypervisor connection

You add power actions to the queue using the SDK&#39;s 
New-BrokerHostingPowerAction cmdlet. You cancel power actions in the queue 
using the Remove-BrokerHostingPowerAction cmdlet. You boost or reduce their 
priority using the Set-BrokerHostingPowerAction cmdlet.

You can also schedule power actions to be executed in the future, using the 
New-BrokerDelayedHostingPowerAction command. Only Shutdown and Suspend 
actions can be scheduled in this way. You can view these delayed power 
actions using Get-BrokerDelayedHostingPowerAction and cancel them with 
Remove-BrokerDelayedHostingPowerAction. When a delayed power action is ready 
to be executed it is deleted, and a corresponding normal power action is 
placed in the queue described above.
</pre></div>


<h2 id="power-policy"><a class="toclink" href="#power-policy">POWER POLICY</a></h2>
<div class="codehilite"><pre><span></span>Policy rules associated with a desktop group allow you to change power 
states at configurable times after session state changes, typically a set 
number of minutes after session disconnection or session logout.

Note that these policy rules are defined directly as properties of the 
desktop group.

These policy actions allow the following operations to be specified:

o   A power action to be performed at a defined period after a session is 
    disconnected 
o   A power action to be performed at a defined extended period after a 
    session is disconnected 
o   A power action to be performed at a defined period after a session is 
    logged off

The two disconnect policy actions are designed to allow multi-stage policies 
such as initially suspending a machine shortly after a session disconnect 
occurs, and then later powering-off the machine if the session has not been 
reconnected.

At the set time after the session state change, the required action is added 
to the power action queue, and this is then throttled and processed as 
normal.
</pre></div>


<h2 id="pool-size-management"><a class="toclink" href="#pool-size-management">POOL SIZE MANAGEMENT</a></h2>
<div class="codehilite"><pre><span></span>You can manage flexibly the number of machines running desktops and 
applications using the pool size. For any given hour of the day and day of 
the week, this is an absolute number of machines or the percentage of the 
total number of machines in the desktop group. The pool size specifies the 
total number of machines that are always running, regardless of whether they 
are in use or idle. (Note: The number of machines does not depend on their 
idle status, but this does affect the buffer size value, which is also used 
to manage pool sizes.)

To start or shut down desktop machines to achieve the desired pool size, the 
system places power actions in the queue. Standard throttling queue 
management sends these to the hypervisors. A single desktop group (and its 
pool) can span multiple hypervisors, so actions to start and shut down 
machines can be added to multiple queues.
</pre></div>


<p>POWER TIME SCHEMES 
    Each single-session desktop group can be associated with one or more power 
    time schemes, each scheme covering a number of days of the week. The time 
    schemes specify, for each hour of the day, whether that hour is peak or 
    off-peak. They also specify the number of running unassigned machines 
    maintained by the broker. </p>
<div class="codehilite"><pre><span></span>You can configure other settings, such as buffer size and any power policy 
rules differently for peak and off-peak hours. You can define the number of 
running machines, idle or in use, either as an absolute value or as a 
percentage of the desktop group size. Machines running desktops and 
applications are started (or shut down when not in use) to match the 
required pool size.

Each power time scheme comprises:

o    The name of the scheme 
o    The pattern of days of the week covered by the scheme 
o    The set of hours considered peak and off peak 
o    The set of pool size values (one for each hour of the day)

The hours of the day used by time schemes are the hours in the time zone for 
the desktop group the scheme is associated with. You cannot associate one 
desktop group with multiple time schemes covering the same day of the week.
</pre></div>


<p>BUFFER SIZE 
    In addition to the pool size, you can optionally configure two buffer sizes 
    for each desktop group, one for peak hours and one for off-peak hours. The 
    buffer size defines the minimum number of idle unassigned machines 
    maintained by the broker and is specified as a percentage of the total 
    machines in the group. These are running machines that are not used by any 
    user session. The buffer size on its own never causes machines to shut down. 
    It causes them to start up so a minimum number of idle machine is always 
    available. The buffer size in conjunction with the pool size can cause 
    machines running desktops or applications to be shut down. </p>
<p>POWER MANAGEMENT OF ASSIGNED MACHINES 
    Automatic power management for private desktop groups provides the ability 
    to power on all assigned machines at the transition to a peak period and 
    respectively power off all machines at the transition to an off-peak period. </p>
<div class="codehilite"><pre><span></span>If a machine is shut down during peak hours it will not be automatically 
powered on again, unless the AutomaticPowerOnForAssignedDuringPeak property 
on the desktop group is also enabled.

Note that all power management facilities apply only to single session 
machines.
</pre></div>


<h2 id="reboot-schedules"><a class="toclink" href="#reboot-schedules">REBOOT SCHEDULES</a></h2>
<div class="codehilite"><pre><span></span>Reboot schedules are commonly used after image updates or to perform regular 
reboots of all machines in a desktop group or catalog to clear down problems 
resulting from a corrupt state or hung/faulty applications.

Reboot schedules allow distributing the reboot operation of all machines 
over a provided duration. Individual machine reboots are scheduled in a way 
that attempts to maintain maximum availability of machines in the group as 
the reboots occur, and avoid boot storms that overload the underlying 
infrastructure.

Reboot schedules are the only form of automatic power management that can 
shut down a machine while users are logged on; however the administrator can 
provide a warning message to be displayed to end users at a specified period 
prior to the shutdown taking effect.
</pre></div>


<p>REBOOT CYCLES 
    Reboot cycles describe the dynamic execution of desktop group or catalog 
    reboot operations. Reboot cycles can be created due to reboot schedules, or 
    by on-demand reboot operations requested via the SDK. </p>
<div class="codehilite"><pre><span></span>RebootCycle objects encapsulate the details of the associated reboot 
operation and can be queried to show the current status.
</pre></div>


<h2 id="status"><a class="toclink" href="#status">STATUS</a></h2>
<div class="codehilite"><pre><span></span>You can view the status of the hypervisor connection on the broker 
hypervisor connection object. You can obtain any hypervisor alerts using the 
Get-BrokerHypervisorAlert cmdlet. You can check the power state of machines 
running desktops or applications using the relevant Machine or Desktop 
objects.
</pre></div>


<h2 id="see-also"><a class="toclink" href="#see-also">SEE ALSO</a></h2>
<div class="codehilite"><pre><span></span>about_Broker_Concepts 
about_Broker_Machines 
about_HypHostSnapin 
New-BrokerHypervisorConnection 
Get-BrokerHypervisorConnection 
Set-BrokerHypervisorConnection 
Remove-BrokerHypervisorConnection 
New-BrokerHostingPowerAction 
Get-BrokerHostingPowerAction 
Set-BrokerHostingPowerAction 
Remove-BrokerHostingPowerAction 
New-BrokerDelayedHostingPowerAction 
Get-BrokerDelayedHostingPowerAction 
Remove-BrokerDelayedHostingPowerAction 
New-BrokerPowerTimeScheme 
Get-BrokerPowerTimeScheme 
Set-BrokerPowerTimeScheme 
Rename-BrokerPowerTimeScheme 
Remove-BrokerPowerTimeScheme 
Get-BrokerRebootCycle 
Set-BrokerRebootCycleMetadata 
Start-BrokerRebootCycle 
Stop-BrokerRebootCycle 
Get-BrokerRebootSchedule 
Set-BrokerRebootSchedule 
New-BrokerRebootSchedule 
Remove-BrokerRebootSchedule 
New-BrokerDesktopGroup 
Get-BrokerDesktopGroup 
Set-BrokerDesktopGroup 
Add-HypMetadata 
Remove-HypMetadata
</pre></div>
              

            </div>
          </div>

        </div>
      </div>

    </section>

  </div>

<!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../about_Broker_PostInstallPreConfiguration/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../about_Broker_RemotePC/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

</body>
</html>
